WITH PO_DATA AS
(SELECT DDPOPAYDB_ENTITY_NUM, DDPOPAYDB_REMIT_CODE, DDPOPAYDB_INST_PFX, DDPOPAYDB_LEAF_NUM, DDPOPAYDB_ISSUED_BRN, DDPOPAYDB_INST_AMT, 
DDPOPAYDB_ISSUED_ON_BRN,DDPOPAYDB_BENEF_NAME1, DDPOPAYDB_STATUS,DDPOPAYDB_INST_DATE, DDPOPAYDB_PAY_CAN_DUP_DATE
FROM DDPOPAYDB
WHERE DDPOPAYDB_ENTITY_NUM=:P_ENTITY_NUMBER
AND DDPOPAYDB_REMIT_CODE=:P_REMIT_CODE
AND DDPOPAYDB_ISSUED_BRN=:P_BRANCH_CODE
AND DDPOPAYDB_INST_DATE <=:P_ASON_DATE
AND DDPOPAYDB_ISSUED_ON_BRN=:P_BRANCH_CODE),
DAY_WISE_PO
AS(
SELECT DDPOPAYDB_ENTITY_NUM, DDPOPAYDB_REMIT_CODE, DDPOPAYDB_INST_PFX, DDPOPAYDB_LEAF_NUM
FROM PO_DATA
MINUS
SELECT DDPOPAYDB_ENTITY_NUM, DDPOPAYDB_REMIT_CODE, DDPOPAYDB_INST_PFX, DDPOPAYDB_LEAF_NUM
FROM PO_DATA
WHERE NVL(DDPOPAYDB_STATUS,'#') IN ('P','C','D')
AND DDPOPAYDB_PAY_CAN_DUP_DATE<=:P_ASON_DATE)
SELECT B.* FROM DAY_WISE_PO A, PO_DATA B
WHERE A.DDPOPAYDB_ENTITY_NUM=B.DDPOPAYDB_ENTITY_NUM
AND  A.DDPOPAYDB_REMIT_CODE=B.DDPOPAYDB_REMIT_CODE
AND A.DDPOPAYDB_INST_PFX=B.DDPOPAYDB_INST_PFX
AND A.DDPOPAYDB_LEAF_NUM=B.DDPOPAYDB_LEAF_NUM;